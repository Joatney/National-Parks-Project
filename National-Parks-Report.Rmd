---
title: "**Species of Concern in National Parks:**\nAssessing Conservation Danger Across the United States"
author: "John Oatney, Gwen Wooten, Tommy Fowler"
output:
  bookdown::html_document2:
    split_by: none
    toc: yes
    toc_depth: 4
    toc_float:
      toc_collapsed: true
    number_sections: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Here are the packages we used:

library(tidyverse)

library(openintro) 

library(ggpubr)  
  
library(leaflet)

devtools::install_github("wmurphyrd/fiftystater")
  
  library(fiftystater)

  data("fifty_states")
  
library(ggmap)
  
library(dplyr)
  
# Here are the data sets:

library(readr)
species <- read_csv("Biodiversity/species.csv")

library(readr)
parks <- read_csv("Biodiversity/parks.csv")

library(readr)
states <- read_csv("Biodiversity/states.csv")
```

```{r Key Data Set Variations, include = FALSE}
speciesendanger <- species %>% 
  filter(!is.na(`Conservation Status`), Occurrence != "Not Confirmed") %>% 
  filter(!Abundance %in% c("Native", "Not Native"))

speciesabundance <- species %>% 
  filter(!is.na(Abundance)) %>% 
  filter(!Abundance %in% c("Native", "Not Native")) %>% 
  group_by(Abundance, `Conservation Status`) %>% 
  summarize(count = n()) %>% 
  filter(`Conservation Status` == "Species of Concern")

speciesnew <- species %>% 
  filter(Occurrence != "Not Confirmed", 
         !Abundance %in% c("Native", "Not Native"), 
         !`Conservation Status` %in% c("Under Review", "In Recovery", "Extinct")) %>% 
  mutate(`Conservation Status` = case_when(`Conservation Status` %in% c("Species of Concern", "Endangered", "Threatened", "Proposed Threatened", "Proposed Endangered") ~ "Species of Concern")) %>% 
  mutate(`Conservation Status` = replace_na(`Conservation Status`, "Not of Concern"))
```

## Our Big Question
When we first looked at the ["Biodiversity in National Parks"](https://www.kaggle.com/datasets/nationalparkservice/park-biodiversity) data set, we were drawn to a variable stating each species's conservation status. We thought to ourselves, how many of these species are of concern? Are certain parks doing worse than others? Are certain states? Eventually, we decided on a question to focus on:

> Is there any state that needs more support in conserving its national parks' wildlife than others?  

## America's National Parks
There are 63 congressionally delegated national parks in the United States as of 2022, each an area of land protected by the National Park Service. The data set we used for this project only focuses on 56 of these national parks. Some of these are excluded because the data set was uploaded to the repository in 2016, before several of them were established. Others are excluded because the data set focuses only on national parks in the United States and not on those in the territories. The 56 national parks that are included in the data set are mapped out here:  

```{r echo = FALSE}
# Because of the nature of leaflet, we had to manually insert each of the National Parks by hand

m <- leaflet() %>%
  addTiles() %>%  
  addMarkers(lng=-68.21, lat=44.35, popup="Acadia National Park") %>%
  addMarkers(lat = 38.68, lng = -109.57, popup = "Arches National Park") %>%
  addMarkers(lat = 43.75, lng = -102.50, popup = "Badlands National Park") %>%
  addMarkers(lat = 29.25, lng = -103.25, popup = "Big Bend National Park") %>%
  addMarkers(lat = 25.65, lng = -80.08, popup = "Biscayne National Park") %>%
  addMarkers(lat = 38.57, lng = -107.72, popup = "Black Canyon of the Gunnison National Park") %>%
  addMarkers(lat = 37.57, lng = -112.18, popup = "Bryce Canyon National Park") %>%
  addMarkers(lat = 38.20, lng = -109.93, popup = "Canyonlands National Park") %>%
  addMarkers(lat = 38.20, lng = -111.17, popup = "Capital Reef National Park") %>%
  addMarkers(lat = 32.17, lng = -104.44, popup = "Carlsbad Caverns National Park") %>%
  addMarkers(lat = 34.01, lng = -119.42, popup = "Channel Islands National Park") %>%
  addMarkers(lat = 33.78, lng = -80.78, popup = "Congaree National Park") %>%
  addMarkers(lat = 42.94, lng = -122.10, popup = "Crater Lake National Park") %>%
  addMarkers(lat = 41.24, lng = -81.55, popup = "Cuyahoga Valley National Park") %>%
  addMarkers(lat = 63.33, lng = -150.50, popup = "Denali National Park and Preserve") %>%
  addMarkers(lat = 36.24, lng = -116.82, popup = "Death Valley National Park") %>%
  addMarkers(lat = 24.63, lng = -82.87, popup = "Dry Tortugas National Park") %>%
  addMarkers(lat = 25.32, lng = -80.93, popup = "Everglades National Park") %>%
  addMarkers(lat = 67.78, lng = -153.30, popup = "Gates of the Arctic National Park and Preserve") %>%
  addMarkers(lat = 48.80, lng = -114.00, popup = "Glacier National Park") %>%
  addMarkers(lat = 58.50, lng = -137.00, popup = "Glacier Bay National Park and Preserve") %>%
  addMarkers(lat = 38.98, lng = -114.30, popup = "Great Basin National Park") %>%
  addMarkers(lat = 36.06, lng = -112.14, popup = "Grand Canyon National Park") %>%
  addMarkers(lat = 37.73, lng = -105.51, popup = "Great Sand Dunes National Park and Preserve") %>%
  addMarkers(lat = 35.68, lng = -83.53, popup = "Great Smoky Mountians National Park") %>%
  addMarkers(lat = 43.73, lng = -110.80, popup = "Grand Teton National Park") %>%
  addMarkers(lat = 31.92, lng = -104.87, popup = "Guadalupe Mountians National Park") %>%
  addMarkers(lat = 20.72, lng = -156.17, popup = "Haleakala Natioanl Park") %>%
  addMarkers(lat = 19.38, lng = -155.20, popup = "Hawaii Volcanoes National Park") %>%
  addMarkers(lat = 34.51, lng = -93.05, popup = "Hot Springs National Park") %>%
  addMarkers(lat = 48.10, lng = -88.55, popup = "Isle Royale National Park") %>%
  addMarkers(lat = 33.79, lng = -115.90, popup = "Joshua Tree National Park") %>%
  addMarkers(lat = 58.50, lng = -155.00, popup = "Katmai National Park and Preserve") %>%
  addMarkers(lat = 59.92, lng = -149.65, popup = "Kenai Fjords National Park") %>%
  addMarkers(lat = 67.55, lng = -159.28, popup = "Kobuk Valley National Park") %>%
  addMarkers(lat = 60.97, lng = -153.42, popup = "Lake Clark National Park and Preserve") %>% 
  addMarkers(lat = 40.49, lng = -121.51, popup = "Lassen Volcanic National Park") %>%
  addMarkers(lat = 37.18, lng = -86.10, popup = "Mammoth Cave National Park") %>%
  addMarkers(lat = 37.18, lng = -108.49, popup = "Mesa Verde National Park") %>%
  addMarkers(lat = 46.85, lng = -121.75, popup = "Mount Rainier National Park") %>%
  addMarkers(lat = 48.70, lng = -121.20, popup = "North Cascades National Park") %>%
  addMarkers(lat = 47.97, lng = -123.50, popup = "Olympic National Park") %>%
  addMarkers(lat = 35.07, lng = -109.78, popup = "Petrified Forest National Park") %>%
  addMarkers(lat = 36.48, lng = -121.16, popup = "Pinnacles National Park") %>%
  addMarkers(lat = 41.30, lng = -124.00, popup = "Redwood National Park") %>%
  addMarkers(lat = 40.40, lng = -105.58, popup = "Rocky Mountain National Park") %>%
  addMarkers(lat = 32.25, lng = -110.50, popup = "Saguaro National Park") %>%
  addMarkers(lat = 36.43, lng = -118.68, popup = "Sequoia and Kings Canyon National Parks") %>%
  addMarkers(lat = 38.53, lng = -78.35, popup = "Shenandoah National Park") %>%
  addMarkers(lat = 46.97, lng = -103.45, popup = "Theodore Roosevelt National Park") %>%
  addMarkers(lat = 48.50, lng = -92.88, popup = "Voyageurs National Park") %>%
  addMarkers(lat = 43.57, lng = -103.48, popup = "Wind Cave National Park") %>%
  addMarkers(lat = 61.00, lng = -142.00, popup = "Wrangell - St Elias National Park and Preserve") %>%
  addMarkers(lat = 44.60, lng = -110.50, popup = "Yellowstone National Park") %>%
  addMarkers(lat = 37.83, lng = -119.50, popup = "Yosemite National Park") %>%
  addMarkers(lat = 37.30, lng = -113.05, popup = "Zion National Park") 
  
m  # Print the map
```  

This data set shows off the immense biodiversity in these national parks, with over forty thousand unique species of plants and animals found across all 56 of the parks. Overwhelmingly, the species recorded by the National Park Service are plants, as shown below:  

```{r echo = FALSE, message = FALSE, warning = FALSE}
speciesnewabundance2 <- speciesnew %>% 
   filter(!is.na(`Abundance`)) %>% 
  group_by(Category, Abundance, `Conservation Status`) %>% 
  summarize(total = n()) 
  
speciesnewabundance2 %>% group_by(Category) %>% 
  mutate(Grandtotal = sum(total)) %>% 
  ungroup() %>% # We want to redefine Category, so we have to ungroup it first
  mutate(Category = fct_reorder(Category, Grandtotal)) %>% 
  ggplot() + 
  geom_col(aes(y = Category, x = total)) +
  labs(y = " ", x = "Total Count") +

  # Hereafter are the theme details
  
  # Making the background
  theme(panel.background = element_rect(fill = "white", 
                                        colour = "white", 
                                        linewidth = 2, 
                                        linetype = "solid"),
        panel.grid.major = element_line(linewidth = 0.5, 
                                        linetype = 'solid',
                                        colour = "white"), 
        panel.grid.minor = element_line(linewidth = 0.25, 
                                        linetype = 'solid',
                                        colour = "white")) +
  # Giving it a title
  labs(title = "Plant and Animal Types") +
  
  # Affecting text attributes
  theme(axis.text.y = element_text(color = "grey27"),
        axis.text.x = element_text(size = 10, color = "grey27"), 
        axis.ticks.y = element_blank(), 
        plot.title = element_text(face = "bold", 
                                  size = 17, 
                                  hjust = 0.5, 
                                  color = "grey27"), 
        plot.subtitle = element_text(face = "italic", 
                                     size = 10, 
                                     hjust = 0.5, 
                                     color = "grey27"), 
        plot.caption = element_text(face = "italic", 
                                    color = "grey27")) + 
  
  # Affecting axis text attributes
  theme(axis.title.y=element_text(colour="grey27", 
                                  face = "bold")) +
  theme(axis.title.x=element_text(colour="grey27", 
                                   face = "bold"))
```  

What this graph represents is the presence of a certain category of species in a park. Some of the species appear more than once (certain types of trees are going to be present in almost all of the parks!), which brings the total over the number of unique species.  

Something easily noticed in this graph is that the category "Vascular Plants" is represented overwhelmingly more than the other categories of species. Because this category includes ferns, flowers, and (you guessed it) trees, it is bound to be the highest category. Not only are there lots of trees in national parks, there are often lots of different types of trees! Conservation organizations like the IUCN or the National Parks Services often focus their efforts of maintaining biodiversity in trees and other vascular plants, so it only makes sense that there are so many represented here.  

Because there are so many species of vascular plant in the data set, we had to remove them from certain data sets so that we could look more closely at trends.

## Conservation Efforts
The National Parks Service which runs all of the national parks in the United States is federally controlled and federally funded. The service is a bureau of the U.S. Department of the Interior, and it is headed by a Director appointed by the President and confirmed by the U.S. Senate.^[https://www.nps.gov/aboutus/index.htm] This Director creates the budget for the national parks, sets programs, and creates policies regarding the parks. If there is anybody who is able to help get funds and support to the parks that need it most, it's the Director of the National Parks Service.  

It is also important to note that every state gets its own budget from the federal government, and a portion of every state's budget goes toward environmental upkeep. So, there is an efficacy to focusing on states rather than just individual parks.  

## Grouping Issues
Knowing all of this national parks information and having a question in hand, we began working with the data. Particularly, we focused on the Conservation Status variable. In the code book for the data set, the variable is listed as using the IUCN conservation status categories.^[https://www.iucnredlist.org/ (under "The IUCN Red List Categories and Criteria")] These categories are: *Not Evaluated, Data Deficient, Least Concern, Near Threatened, Vulnerable, Endangered, Critically Endangered, Extinct in the Wild,* and *Extinct*. They show a clear progression from least to most concern and would be incredibly helpful as categories for our research purposes. The problem is, though, that the data set is not actually using those categories! What we have instead is: *Under Review, In Recovery, Proposed Threatened, Threatened, Proposed Endangered, Endangered, Species of Concern,* and *Extinct*.  

What is worse is the distribution of the categories:

```{r echo = FALSE, message = FALSE, warning = FALSE}
speciesconservationviz <- speciesendanger %>% 
  group_by(`Conservation Status`) %>% 
  summarize(count = n()) %>% 
  filter(!is.na(`Conservation Status`)) %>% 
  arrange(desc(count)) %>% 
  mutate(perc = (count / sum(count)) * 100) %>% 
  mutate(ypos = cumsum(perc)- 0.4*perc ) %>% 
  mutate(perc2 = round(perc, 1)) %>% 
  mutate(perc3 = paste0(perc2, "%"))

ggplot(speciesconservationviz, aes(x = "", y = perc, fill = reorder(`Conservation Status`, count), label = perc3)) +
  geom_bar(stat = "identity", width = 1, color = "white") + 
  coord_polar("y", start = 0) + 
  theme_void() + 
  scale_fill_manual(values = c("#8F0F1B", "#BE3ACD", "#304F9B", "#C7DD91", "#48A421", "#69EF7B", "#11CCDC", "black"),
                    breaks = c("Species of Concern", "Endangered", "Under Review", "Threatened", "In Recovery", "Proposed Endangered", "Proposed Threatened", "Extinct")) +
  geom_text(aes(y = ypos), color = "white", size = 6, check_overlap = TRUE) + 
    labs(fill = "Conservation Status", 
         title = "How Often Are Species Assigned Each Conservation Status?", 
         caption = "This data excludes any species that are not given a category.\n(Including species not in danger of extinction).")
```  

Of all of the species that were assigned a conservation status, 83.4% of them were assigned Species of Concern! That number is too high to be normal. What seems to have happened is that the people in the National Parks Service who gathered the data used lay terms and general groupings when assigning conservation status. Some of them must have thrown any species of any concern category into "Species of Concern".  

This poses a problem for our evaluation of concern, though, as we have no way of looking at the official categories in any meaningful way across the data set. To counter this issue, we wrangled the data and grouped these conservation status categories into two types: "Of Concern", composed of *Proposed Threatened, Threatened, Proposed Endangered, Endangered*, and *Species of Concern*; and "Not of Concern", composed of all NA values. The other categories, due to their small size and their lack of exact relation to either category, are ignored for considerations of concern.

## How Much Concern Are Species Under?
Using our new binary category for conservation status, we can return to the categories from before. Because there are so many species of vascular plants represented in the national parks, it would be reasonable to assume that there would be a lot of vascular plant species of concern. With global warming and forest fires, trees are dying all over the globe. This graph shows that this is not the case, though!  

```{r echo = FALSE, message = FALSE, warning = FALSE}
graph2 <- speciesnew %>% 
 filter(!is.na(Abundance), Abundance != 'Unknown') %>% 
  filter(Occurrence != "Not Confirmed") %>% 
   group_by(Category, Abundance, `Conservation Status`) %>% 
  summarize(total = n()) %>% 
  mutate(`Conservation Status` = replace_na(`Conservation Status`, "Not Threatened or Endagered")) %>% 
  filter(total > 10) 

graph3 <- graph2 %>% 
  filter(Category != "Vascular Plant")


#GRAPHS START

ggplot(graph2) +
geom_col(aes(y = reorder(Category, total), x=total, fill=`Conservation Status`), stat='identity') +
     labs(y = " ", x = "Total Count") +
 # Making the background
  theme(panel.background = element_rect(fill = "white", 
                                        colour = "white", 
                                        linewidth = 2, 
                                        linetype = "solid"),
        panel.grid.major = element_line(linewidth = 0.5, 
                                        linetype = 'solid',
                                        colour = "white"), 
        panel.grid.minor = element_line(linewidth = 0.25, 
                                        linetype = 'solid',
                                        colour = "white")) +
  
  # Changing the legend
  guides(fill = guide_legend(title.position = "top", 
                             title = "Level of Concern")) + 
  
  # Giving it a title
  labs(title = "Concern of Plant and Animal Types") +
  
  # Affecting text attributes
  theme(axis.text.y = element_text(color = "grey27"),
        axis.text.x = element_text(size = 10, color = "grey27"), 
        axis.ticks.y = element_blank(), 
        plot.title = element_text(face = "bold", 
                                  size = 17, 
                                  hjust = 0.5, 
                                  color = "grey27"), 
        plot.subtitle = element_text(face = "italic", 
                                     size = 10, 
                                     hjust = 0.5, 
                                     color = "grey27"), 
        plot.caption = element_text(face = "italic", 
                                    color = "grey27"),
        
        # Affecting legend attributes
        legend.position = "right", 
        legend.justification = "left",  
        legend.background = element_rect(fill ="white"), 
        legend.text = element_text(face="italic", 
                                   color = "grey27"), 
        legend.title = element_text(color = "grey27", 
                                    face = "bold")) +
  
  # Affecting axis text attributes
  theme(axis.title.y=element_text(colour="grey27", 
                                  face = "bold")) +
  theme(axis.title.x=element_text(colour="grey27", 
                                   face = "bold")) 
```  

Generally, the majority of species are not of concern. This means that financial and policy support can be more accurately focused in places that need it the most. That being said, there are some trends that appear in this graph.  

Vascular plants have a proportionally low number of species of concern. Now, there is another point to note on that subject, which is that almost none of the categories has a significant proportion of concern. This does not change, though, that the proportion is much lower than we had anticipated. Perhaps the tree planting and protection programs from the National Parks Service and the IUCN really are protecting the trees effectively in national parks.  

The same cannot be said for birds in national parks. The proportion of birds of concern to birds not of concern is higher than in any other category. It is still rather low, but one must remember that this is counting number of *species*, and not number of *individuals*. There are hundreds of species of birds that are under conservation concern and need assistance. These numbers being so much higher shows that birds are often in need of more support than other categories of species.  

## Birds As Indicators of Concern
If birds are in greater need of support, then they could be used as an indicator of which parks (or for our purposes, which states) are most in need of support. Of course, the bird factor alone would not be enough to tell us for sure, but we knew that if we could find a state that favored birds, had a high proportion of species of concern, and had other factors making that state need support, we would have a well-founded idea of which state answers our question.  

So, the first thing we did was we looked at the category counts for each state, pulling out which was the highest. For thse purposes, we removed vascular plants, as we know already that they are not hugely of concern, and we could expect them to be the most common in every state if we kept them in.  

```{r echo = FALSE, message = FALSE, warning = FALSE}
statecategories <- speciesnew %>% 
  filter(Category != "Vascular Plant") %>% 
  group_by(`Park Name`, Category) %>% 
  left_join(parks) %>% select(`Park Code`, `Park Name`, State, Acres, Category) %>% 
  separate(State, c("State1", "State2", "State3"), sep = ", ") %>% 
  pivot_longer(cols = c(State1, State2, State3), names_to = "State Type", values_to = "State") %>% 
  filter(!is.na(State)) %>% 
  group_by(State, Category) %>% 
  summarize(count = n()) %>% 
  
  # Now we do an inefficient but accurate method of pulling out the highest categories
  
  filter(count %in% c(1359, 300, 897, 2130, 811, 1225, 2149, 1564, 269, 243, 244, 230, 1754, 644, 159, 606, 242, 147, 473, 426, 649, 987, 712, 682, 1715, 359)) %>% 
  
  # Now we join it to make it work as a map
  
  full_join(states) %>% 
  mutate(state_name = str_to_lower(abbr2state(State)))

# GRAPHS START

statecategories %>% 
  ggplot() +
  geom_map(
    map = fifty_states,
    aes(
      map_id = state_name,
      fill = Category
    ), color = "black"
  ) + 
  expand_limits(x = map_data("state")$long, y = map_data("state")$lat) + 
  labs(fill = "Species\nCategory", title = "Most Common Species Category per State") +
  theme_void()
```  

Most states have more species of birds than anything else, which makes sense considering they were the second highest category after vascular plants. Several states showed other values, mainly in insects, but for the purposes of using birds as indicators of concern, we can exclude those states. They likely do not have enough birds to be important to this consideration.  

Using just those states that have more species of birds than any other category, we looked at how many different species of birds were present in each state. It would be reasonable to assume that the state with the highest number of bird species would be in need of the most support since we are using birds as a sort of metric for concern.

```{r echo = FALSE, message = FALSE, warning = FALSE}
statecategories %>% 
  filter(Category == "Bird") %>% 
  ggplot() + 
  geom_bar(
    aes(
      x = fct_reorder(State, count), 
      y = count
    ), stat = "identity"
  ) + 
  labs(x = "State", y = "# of Species", title = "How Many Bird Species Are There In States\nWhere Birds Are The Most Common Category?")
```  

What this graph shows is that California has the highest number of bird species with over 2,000 species represented across its national parks. This first sign indicator suggests that California could be the state that needs the most financial support. Looking at more numeric indicators, we can focus on California and see whether the amount of concern lines up with the bird indicator.  

## Identifying Where Support Should Go
We have already established how support gets delegated and change gets made in the National Parks Service, but where should the Director's support really get focused? You might think to focus on individual parks, but you should remember that states have their own budgets, and that some states have more parks than others. The National Parks Service could choose to focus their money and policy on a state-by-state level depending on which states need the most financial support.  

If that is the path that they choose to take, as we suggest it should be, the first thing to consider is how many parks each state has.  

It is important to note that some national parks exist in more than one state. For this map, each state that those parks are in is considered as having the park. This means that some parks are represented more than once, but for the purposes of considering how many parks a state needs to take care of, that is fine.  

```{r echo = FALSE, message = FALSE, warning = FALSE}
parkstate <- speciesendanger %>% 
  group_by(`Park Name`, `Conservation Status`) %>% 
  summarize(count = n()) %>% 
  pivot_wider(names_from = `Conservation Status`, 
              values_from = count, 
              values_fill = 0) %>% 
  left_join(parks) %>% 
  select(`Park Code`, `Park Name`, State, Acres, Endangered, `In Recovery`, `Species of Concern`, `Under Review`, Threatened, `Proposed Threatened`, Extinct, `Proposed Endangered`) %>% 
  
  # Separating parks with several states out into individual state/park pairings
  
  separate(State, c("State1", "State2", "State3"), sep = ", ") %>% 
  pivot_longer(cols = c(State1, State2, State3), names_to = "State Type", values_to = "State") %>% 
  filter(!is.na(State))

statevalues <- parkstate %>% 
  group_by(State) %>% 
  summarize(Concern = sum(`Species of Concern`), ConcernAvg = mean(`Species of Concern`), Count = n()) %>% 
  mutate(ConcernAvg = round(ConcernAvg, 2))

statevaluesmap <- statevalues %>% 
  full_join(states) %>% 
   mutate(state_name = str_to_lower(abbr2state(State)))


# GRAPHS START

statevaluesmap %>%
  ggplot() +
  geom_map(
    map = fifty_states,
    aes(
      map_id = state_name,
      fill = Count
    )
  ) +
  expand_limits(x = map_data("state")$long, y = map_data("state")$lat) + 
  labs(fill = "# of\nParks", title = "# of Parks per State") +
  theme_void()
```  

There are two states that are tied for having the highest number of parks: Alaska and California. Some states like Idaho and Colorado have a slightly higher amount, but no state is able to rival the eight parks in both Alaska and California. California now has two factors contributing to it with the bird indicator and the number of parks.  

It is possible, then, that one of those two states is in need of the most support. Having that many parks must cost a lot of money! Considering, then, that Alaska and California have the highest number of parks, we looked at the number of species of concern on similar maps to see whether either of those two states had irregularly high numbers.  

First, we looked at total species of concern:  

```{r echo = FALSE, message = FALSE, warning = FALSE}
statevaluesmap %>%
  ggplot() +
  geom_map(
    map = fifty_states,
    aes(
      map_id = state_name,
      fill = Concern
    )
  ) +
  expand_limits(x = map_data("state")$long, y = map_data("state")$lat) + 
  labs(fill = "Total Species\nof Concern", title = "Total Species of Concern per State") +
  theme_void()
```  

This map shows that California, with a massive majority, has the highest number of species of concern: over 600 species of concern! This would make sense because having more parks would mean having more species, but Alaska does not show the same trend. In fact, Alaska is in the lower half of the range, with relatively few total species of concern. Perhaps, though, this is because Alaska's climate does not allow for a lot of diversity in species.  

Maybe changing from a total to an average would make the trend closer between the two highest states:

```{r echo = FALSE, message = FALSE, warning = FALSE}
statevaluesmap %>%
  ggplot() +
  geom_map(
    map = fifty_states,
    aes(
      map_id = state_name,
      fill = ConcernAvg
    )
  ) +
  expand_limits(x = map_data("state")$long, y = map_data("state")$lat) + 
  labs(fill = "Avg. #\nSpecies of\nConcern", title = "Average Species of Concern per State") +
  theme_void()
```  

Now this map tells an entirely different story. Alaska takes point even lower, with close to no species of concern as the average per park! From this, it seems clear that Alaska, despite having eight parks, is not in need of focused support from the National Parks Service. What this map does show, though, is a trend for Texas, Tennessee, and North Carolina having high averages for species of concern. These states have very few parks and so their high species of concern numbers in those few parks mean that they show up quite strongly on this map. This would be cause to consider those states, but looking at California, which we know has eight national parks, we can see that it is not doing so well. The average is certainly shining a better light on California, but it is still showing an average of almost 80 species of concern per park.  

We decided that we wanted to see these concern numbers from one more angle, though, and so we considered the percentage of species of concern against species not of concern in each state to see if that trend could steer us away from the conclusion that the other maps have been drawing us toward: that California is in the greatest need of support.

```{r echo = FALSE, message = FALSE, warning = FALSE}
concernpercent <- speciesnew %>% 
  group_by(Category, `Conservation Status`) %>% 
  summarize(total_ofconcern = n()) %>% 
  mutate(total_species = sum(total_ofconcern)) %>% 
  ungroup() %>% 
  mutate(percent = (total_ofconcern/total_species)*100) %>% 
  filter(`Conservation Status` != "Not of Concern")

speciespark <- parks %>% 
  full_join(species)

speciespark2 <- speciespark %>% 
filter(Occurrence != "Not Confirmed", 
       !Abundance %in% c("Native", "Not Native"), 
       !`Conservation Status` %in% c("Under Review", "In Recovery", "Extinct")) %>% 
  
  # Renaming the species of concern into the binary categories
  
  mutate(`Conservation Status` = case_when(`Conservation Status` %in% c("Species of Concern", "Endangered", "Threatened", "Proposed Threatened", "Proposed Endangered") ~ "Species of Concern")) %>% 
  mutate(`Conservation Status` = replace_na(`Conservation Status`, "Not of Concern")) 

concernpercent_perstate <- speciespark2 %>% 
  separate(State, c("State1", "State2", "State3"), sep = ", ") %>% 
  pivot_longer(cols = c(State1, State2, State3), 
               names_to = "State Type", 
               values_to = "State") %>% 
  filter(!is.na(State)) %>% 
  group_by(State, `Conservation Status`) %>% 
  summarize(total_ofconcern = n()) %>% 
  mutate(total_species_perstate = sum(total_ofconcern)) %>% 
  ungroup() %>% 
  mutate(percent = (total_ofconcern/total_species_perstate)*100) %>% 
  filter(`Conservation Status` != "Not of Concern")

statevaluesmap_perc <- concernpercent_perstate %>% 
  full_join(states) %>% 
   mutate(state_name = str_to_lower(abbr2state(State)))

# GRAPHS START

statevaluesmap_perc %>%
  ggplot() +
  geom_map(
    map = fifty_states,
    aes(
      map_id = state_name,
      fill = percent
    )
  ) +
  expand_limits(x = map_data("state")$long, y = map_data("state")$lat) + 
  labs(fill = "Percent\nSpecies of\nConcern", title = "Percent Species of Concern per State") +
  theme_void()
```  

The numbers here are low, but that is to be expected, as we already know that most species are not of concern. What this trend shows, though, is that Alaska still has few species of concern, with a percentage just above 3% species of concern, whereas California is much higher, with the other southwestern states at just about 6% species of concern.  

One of the standout states in this map is New Mexico, but since it only has one national park, its high percentage is not as important.  

What these maps together show is that California has a high proportion of species of concern when compared to other states.   

## Conclusion
Factoring in how many parks the state has as well as the indicator of how many species of birds there are in California, it is safe to conclude that California is in the greatest need of support. While California might not have the worst numbers for species of concern across the board, it is doing not well in every category, showing the highest total and both high averages and percentages. These numbers are especially striking when compared to Alaska which has the same number of parks and has some of the lowest numbers for species of concern across all categories.  

What this suggests to us is that California could be doing much better, and that it needs more support than any other stet to get past its environmental issues.  

Here is a heat map of California which shows the density of species of concern across the state. This map shows that [PLEASE FILL IN WHAT THIS MAP REPRESENTS, GWEN]  

```{r echo = FALSE, message = FALSE, warning = FALSE}
californiaconclusion <- read_csv("Biodiversity/californiaconclusion.csv")

caliconc <- californiaconclusion %>% 
  select(c('Park Code', 'Park', '# Endangered Species', 'Latitude', 'Longitude'))

# Obtaining the map tile

US_map2 <- get_stamenmap(
  bbox = c(left = -125, bottom = 33, right = -115, top = 45),
  maptype = "terrain",
  zoom = 7
)

# Putting the heat map on the tile

ggmap(US_map2) +
  geom_density_2d(data = caliconc, aes(x = Longitude, y = Latitude), size = 0.3) +
  stat_density_2d(data = caliconc, aes(x = Longitude, y = Latitude, fill = stat(level)), size = 0.05, alpha = .2, bins = 10, geom = "polygon", color = 'darkblue') +
  scale_alpha(guide = 'none') +
  scale_fill_gradient(low = "darkblue", high = "red", guide = 'none') +
  labs(x = "Longitude", y = "Latitude", title = "Density of Endangered Species\nby National Park in California")

```  

> It is our recommendation, then, for the National Parks Service to focus their support on California.

---  

## Appendix
Here is all of the code used in this report.

### Key Data Set Variations
```
speciesendanger <- species %>% 
  filter(!is.na(`Conservation Status`), Occurrence != "Not Confirmed") %>% 
  filter(!Abundance %in% c("Native", "Not Native"))

speciesabundance <- species %>% 
  filter(!is.na(Abundance)) %>% 
  filter(!Abundance %in% c("Native", "Not Native")) %>% 
  group_by(Abundance, `Conservation Status`) %>% 
  summarize(count = n()) %>% 
  filter(`Conservation Status` == "Species of Concern")

speciesnew <- species %>% 
  filter(Occurrence != "Not Confirmed", 
         !Abundance %in% c("Native", "Not Native"), 
         !`Conservation Status` %in% c("Under Review", "In Recovery", "Extinct")) %>% 
  mutate(`Conservation Status` = case_when(`Conservation Status` %in% c("Species of Concern", "Endangered", "Threatened", "Proposed Threatened", "Proposed Endangered") ~ "Species of Concern")) %>% 
  mutate(`Conservation Status` = replace_na(`Conservation Status`, "Not of Concern"))
```

### National Parks Map
```
# Because of the nature of leaflet, we had to manually insert each of the National Parks by hand

m <- leaflet() %>%
  addTiles() %>%  
  addMarkers(lng=-68.21, lat=44.35, popup="Acadia National Park") %>%
  addMarkers(lat = 38.68, lng = -109.57, popup = "Arches National Park") %>%
  addMarkers(lat = 43.75, lng = -102.50, popup = "Badlands National Park") %>%
  addMarkers(lat = 29.25, lng = -103.25, popup = "Big Bend National Park") %>%
  addMarkers(lat = 25.65, lng = -80.08, popup = "Biscayne National Park") %>%
  addMarkers(lat = 38.57, lng = -107.72, popup = "Black Canyon of the Gunnison National Park") %>%
  addMarkers(lat = 37.57, lng = -112.18, popup = "Bryce Canyon National Park") %>%
  addMarkers(lat = 38.20, lng = -109.93, popup = "Canyonlands National Park") %>%
  addMarkers(lat = 38.20, lng = -111.17, popup = "Capital Reef National Park") %>%
  addMarkers(lat = 32.17, lng = -104.44, popup = "Carlsbad Caverns National Park") %>%
  addMarkers(lat = 34.01, lng = -119.42, popup = "Channel Islands National Park") %>%
  addMarkers(lat = 33.78, lng = -80.78, popup = "Congaree National Park") %>%
  addMarkers(lat = 42.94, lng = -122.10, popup = "Crater Lake National Park") %>%
  addMarkers(lat = 41.24, lng = -81.55, popup = "Cuyahoga Valley National Park") %>%
  addMarkers(lat = 63.33, lng = -150.50, popup = "Denali National Park and Preserve") %>%
  addMarkers(lat = 36.24, lng = -116.82, popup = "Death Valley National Park") %>%
  addMarkers(lat = 24.63, lng = -82.87, popup = "Dry Tortugas National Park") %>%
  addMarkers(lat = 25.32, lng = -80.93, popup = "Everglades National Park") %>%
  addMarkers(lat = 67.78, lng = -153.30, popup = "Gates of the Arctic National Park and Preserve") %>%
  addMarkers(lat = 48.80, lng = -114.00, popup = "Glacier National Park") %>%
  addMarkers(lat = 58.50, lng = -137.00, popup = "Glacier Bay National Park and Preserve") %>%
  addMarkers(lat = 38.98, lng = -114.30, popup = "Great Basin National Park") %>%
  addMarkers(lat = 36.06, lng = -112.14, popup = "Grand Canyon National Park") %>%
  addMarkers(lat = 37.73, lng = -105.51, popup = "Great Sand Dunes National Park and Preserve") %>%
  addMarkers(lat = 35.68, lng = -83.53, popup = "Great Smoky Mountians National Park") %>%
  addMarkers(lat = 43.73, lng = -110.80, popup = "Grand Teton National Park") %>%
  addMarkers(lat = 31.92, lng = -104.87, popup = "Guadalupe Mountians National Park") %>%
  addMarkers(lat = 20.72, lng = -156.17, popup = "Haleakala Natioanl Park") %>%
  addMarkers(lat = 19.38, lng = -155.20, popup = "Hawaii Volcanoes National Park") %>%
  addMarkers(lat = 34.51, lng = -93.05, popup = "Hot Springs National Park") %>%
  addMarkers(lat = 48.10, lng = -88.55, popup = "Isle Royale National Park") %>%
  addMarkers(lat = 33.79, lng = -115.90, popup = "Joshua Tree National Park") %>%
  addMarkers(lat = 58.50, lng = -155.00, popup = "Katmai National Park and Preserve") %>%
  addMarkers(lat = 59.92, lng = -149.65, popup = "Kenai Fjords National Park") %>%
  addMarkers(lat = 67.55, lng = -159.28, popup = "Kobuk Valley National Park") %>%
  addMarkers(lat = 60.97, lng = -153.42, popup = "Lake Clark National Park and Preserve") %>% 
  addMarkers(lat = 40.49, lng = -121.51, popup = "Lassen Volcanic National Park") %>%
  addMarkers(lat = 37.18, lng = -86.10, popup = "Mammoth Cave National Park") %>%
  addMarkers(lat = 37.18, lng = -108.49, popup = "Mesa Verde National Park") %>%
  addMarkers(lat = 46.85, lng = -121.75, popup = "Mount Rainier National Park") %>%
  addMarkers(lat = 48.70, lng = -121.20, popup = "North Cascades National Park") %>%
  addMarkers(lat = 47.97, lng = -123.50, popup = "Olympic National Park") %>%
  addMarkers(lat = 35.07, lng = -109.78, popup = "Petrified Forest National Park") %>%
  addMarkers(lat = 36.48, lng = -121.16, popup = "Pinnacles National Park") %>%
  addMarkers(lat = 41.30, lng = -124.00, popup = "Redwood National Park") %>%
  addMarkers(lat = 40.40, lng = -105.58, popup = "Rocky Mountain National Park") %>%
  addMarkers(lat = 32.25, lng = -110.50, popup = "Saguaro National Park") %>%
  addMarkers(lat = 36.43, lng = -118.68, popup = "Sequoia and Kings Canyon National Parks") %>%
  addMarkers(lat = 38.53, lng = -78.35, popup = "Shenandoah National Park") %>%
  addMarkers(lat = 46.97, lng = -103.45, popup = "Theodore Roosevelt National Park") %>%
  addMarkers(lat = 48.50, lng = -92.88, popup = "Voyageurs National Park") %>%
  addMarkers(lat = 43.57, lng = -103.48, popup = "Wind Cave National Park") %>%
  addMarkers(lat = 61.00, lng = -142.00, popup = "Wrangell - St Elias National Park and Preserve") %>%
  addMarkers(lat = 44.60, lng = -110.50, popup = "Yellowstone National Park") %>%
  addMarkers(lat = 37.83, lng = -119.50, popup = "Yosemite National Park") %>%
  addMarkers(lat = 37.30, lng = -113.05, popup = "Zion National Park") 
  
m  # Print the map
```

### Species Categories Bar Chart
```
speciesnewabundance2 <- speciesnew %>% 
   filter(!is.na(`Abundance`)) %>% 
  group_by(Category, Abundance, `Conservation Status`) %>% 
  summarize(total = n()) 
  
speciesnewabundance2 %>% group_by(Category) %>% 
  mutate(Grandtotal = sum(total)) %>% 
  ungroup() %>% # We want to redefine Category, so we have to ungroup it first
  mutate(Category = fct_reorder(Category, Grandtotal)) %>% 
  ggplot() + 
  geom_col(aes(y = Category, x = total)) +
  labs(y = " ", x = "Total Count") +

  # Hereafter are the theme details
  
  # Making the background
  theme(panel.background = element_rect(fill = "white", 
                                        colour = "white", 
                                        linewidth = 2, 
                                        linetype = "solid"),
        panel.grid.major = element_line(linewidth = 0.5, 
                                        linetype = 'solid',
                                        colour = "white"), 
        panel.grid.minor = element_line(linewidth = 0.25, 
                                        linetype = 'solid',
                                        colour = "white")) +
  # Giving it a title
  labs(title = "Plant and Animal Types") +
  
  # Affecting text attributes
  theme(axis.text.y = element_text(color = "grey27"),
        axis.text.x = element_text(size = 10, color = "grey27"), 
        axis.ticks.y = element_blank(), 
        plot.title = element_text(face = "bold", 
                                  size = 17, 
                                  hjust = 0.5, 
                                  color = "grey27"), 
        plot.subtitle = element_text(face = "italic", 
                                     size = 10, 
                                     hjust = 0.5, 
                                     color = "grey27"), 
        plot.caption = element_text(face = "italic", 
                                    color = "grey27")) + 
  
  # Affecting axis text attributes
  theme(axis.title.y=element_text(colour="grey27", 
                                  face = "bold")) +
  theme(axis.title.x=element_text(colour="grey27", 
                                   face = "bold"))
```

### Conservation Grouping Pie Chart
```
speciesconservationviz <- speciesendanger %>% 
  group_by(`Conservation Status`) %>% 
  summarize(count = n()) %>% 
  filter(!is.na(`Conservation Status`)) %>% 
  arrange(desc(count)) %>% 
  mutate(perc = (count / sum(count)) * 100) %>% 
  mutate(ypos = cumsum(perc)- 0.4*perc ) %>% 
  mutate(perc2 = round(perc, 1)) %>% 
  mutate(perc3 = paste0(perc2, "%"))

ggplot(speciesconservationviz, aes(x = "", y = perc, fill = reorder(`Conservation Status`, count), label = perc3)) +
  geom_bar(stat = "identity", width = 1, color = "white") + 
  coord_polar("y", start = 0) + 
  theme_void() + 
  scale_fill_manual(values = c("#8F0F1B", "#BE3ACD", "#304F9B", "#C7DD91", "#48A421", "#69EF7B", "#11CCDC", "black"),
                    breaks = c("Species of Concern", "Endangered", "Under Review", "Threatened", "In Recovery", "Proposed Endangered", "Proposed Threatened", "Extinct")) +
  geom_text(aes(y = ypos), color = "white", size = 6, check_overlap = TRUE) + 
    labs(fill = "Conservation Status", 
         title = "How Often Are Species Assigned Each Conservation Status?", 
         caption = "This data excludes any species that are not given a category.\n(Including species not in danger of extinction).")
```

### Concern of Categories Bar Chart
```
graph2 <- speciesnew %>% 
 filter(!is.na(Abundance), Abundance != 'Unknown') %>% 
  filter(Occurrence != "Not Confirmed") %>% 
   group_by(Category, Abundance, `Conservation Status`) %>% 
  summarize(total = n()) %>% 
  mutate(`Conservation Status` = replace_na(`Conservation Status`, "Not Threatened or Endagered")) %>% 
  filter(total > 10) 

graph3 <- graph2 %>% 
  filter(Category != "Vascular Plant")


#GRAPHS START

ggplot(graph2) +
geom_col(aes(y = reorder(Category, total), x=total, fill=`Conservation Status`), stat='identity') +
     labs(y = " ", x = "Total Count") +
 # Making the background
  theme(panel.background = element_rect(fill = "white", 
                                        colour = "white", 
                                        linewidth = 2, 
                                        linetype = "solid"),
        panel.grid.major = element_line(linewidth = 0.5, 
                                        linetype = 'solid',
                                        colour = "white"), 
        panel.grid.minor = element_line(linewidth = 0.25, 
                                        linetype = 'solid',
                                        colour = "white")) +
  
  # Changing the legend
  guides(fill = guide_legend(title.position = "top", 
                             title = "Level of Concern")) + 
  
  # Giving it a title
  labs(title = "Concern of Plant and Animal Types") +
  
  # Affecting text attributes
  theme(axis.text.y = element_text(color = "grey27"),
        axis.text.x = element_text(size = 10, color = "grey27"), 
        axis.ticks.y = element_blank(), 
        plot.title = element_text(face = "bold", 
                                  size = 17, 
                                  hjust = 0.5, 
                                  color = "grey27"), 
        plot.subtitle = element_text(face = "italic", 
                                     size = 10, 
                                     hjust = 0.5, 
                                     color = "grey27"), 
        plot.caption = element_text(face = "italic", 
                                    color = "grey27"),
        
        # Affecting legend attributes
        legend.position = "right", 
        legend.justification = "left",  
        legend.background = element_rect(fill ="white"), 
        legend.text = element_text(face="italic", 
                                   color = "grey27"), 
        legend.title = element_text(color = "grey27", 
                                    face = "bold")) +
  
  # Affecting axis text attributes
  theme(axis.title.y=element_text(colour="grey27", 
                                  face = "bold")) +
  theme(axis.title.x=element_text(colour="grey27", 
                                   face = "bold")) 
```  

### Most Common Species Category per State Map
```
statecategories <- speciesnew %>% 
  filter(Category != "Vascular Plant") %>% 
  group_by(`Park Name`, Category) %>% 
  left_join(parks) %>% select(`Park Code`, `Park Name`, State, Acres, Category) %>% 
  separate(State, c("State1", "State2", "State3"), sep = ", ") %>% 
  pivot_longer(cols = c(State1, State2, State3), names_to = "State Type", values_to = "State") %>% 
  filter(!is.na(State)) %>% 
  group_by(State, Category) %>% 
  summarize(count = n()) %>% 
  
  # Now we do an inefficient but accurate method of pulling out the highest categories
  
  filter(count %in% c(1359, 300, 897, 2130, 811, 1225, 2149, 1564, 269, 243, 244, 230, 1754, 644, 159, 606, 242, 147, 473, 426, 649, 987, 712, 682, 1715, 359)) %>% 
  
  # Now we join it to make it work as a map
  
  full_join(states) %>% 
  mutate(state_name = str_to_lower(abbr2state(State)))

# GRAPHS START

statecategories %>% 
  ggplot() +
  geom_map(
    map = fifty_states,
    aes(
      map_id = state_name,
      fill = Category
    ), color = "black"
  ) + 
  expand_limits(x = map_data("state")$long, y = map_data("state")$lat) + 
  labs(fill = "Species\nCategory", title = "Most Common Species Category per State") +
  theme_void()
```  

### # of Bird Species per State Map
```
statecategories %>% 
  filter(Category == "Bird") %>% 
  ggplot() + 
  geom_bar(
    aes(
      x = fct_reorder(State, count), 
      y = count
    ), stat = "identity"
  ) + 
  labs(x = "State", y = "# of Species", title = "How Many Bird Species Are There In States\nWhere Birds Are The Most Common Category?")
```  

### # of Parks per State Map
```
parkstate <- speciesendanger %>% 
  group_by(`Park Name`, `Conservation Status`) %>% 
  summarize(count = n()) %>% 
  pivot_wider(names_from = `Conservation Status`, 
              values_from = count, 
              values_fill = 0) %>% 
  left_join(parks) %>% 
  select(`Park Code`, `Park Name`, State, Acres, Endangered, `In Recovery`, `Species of Concern`, `Under Review`, Threatened, `Proposed Threatened`, Extinct, `Proposed Endangered`) %>% 
  
  # Separating parks with several states out into individual state/park pairings
  
  separate(State, c("State1", "State2", "State3"), sep = ", ") %>% 
  pivot_longer(cols = c(State1, State2, State3), names_to = "State Type", values_to = "State") %>% 
  filter(!is.na(State))

statevalues <- parkstate %>% 
  group_by(State) %>% 
  summarize(Concern = sum(`Species of Concern`), ConcernAvg = mean(`Species of Concern`), Count = n()) %>% 
  mutate(ConcernAvg = round(ConcernAvg, 2))

statevaluesmap <- statevalues %>% 
  full_join(states) %>% 
   mutate(state_name = str_to_lower(abbr2state(State))
   
# GRAPHS START
   
statevaluesmap %>%
  ggplot() +
  geom_map(
    map = fifty_states,
    aes(
      map_id = state_name,
      fill = Count
    )
  ) +
  expand_limits(x = map_data("state")$long, y = map_data("state")$lat) + 
  labs(fill = "# of\nParks", title = "# of Parks per State") +
  theme_void()
```  

### Total Species of Concern per State Map
```
statevaluesmap %>%
  ggplot() +
  geom_map(
    map = fifty_states,
    aes(
      map_id = state_name,
      fill = Concern
    )
  ) +
  expand_limits(x = map_data("state")$long, y = map_data("state")$lat) + 
  labs(fill = "Total Species\nof Concern", title = "Total Species of Concern per State") +
  theme_void()
```  

### Average Species of Concern per State Map
```
statevaluesmap %>%
  ggplot() +
  geom_map(
    map = fifty_states,
    aes(
      map_id = state_name,
      fill = ConcernAvg
    )
  ) +
  expand_limits(x = map_data("state")$long, y = map_data("state")$lat) + 
  labs(fill = "Avg. #\nSpecies of\nConcern", title = "Average Species of Concern per State") +
  theme_void()
```  

### Percent Species of Concern per State Map
```
concernpercent <- speciesnew %>% 
  group_by(Category, `Conservation Status`) %>% 
  summarize(total_ofconcern = n()) %>% 
  mutate(total_species = sum(total_ofconcern)) %>% 
  ungroup() %>% 
  mutate(percent = (total_ofconcern/total_species)*100) %>% 
  filter(`Conservation Status` != "Not of Concern")

speciespark <- parks %>% 
  full_join(species)

speciespark2 <- speciespark %>% 
filter(Occurrence != "Not Confirmed", 
       !Abundance %in% c("Native", "Not Native"), 
       !`Conservation Status` %in% c("Under Review", "In Recovery", "Extinct")) %>% 
  
  # Renaming the species of concern into the binary categories
  
  mutate(`Conservation Status` = case_when(`Conservation Status` %in% c("Species of Concern", "Endangered", "Threatened", "Proposed Threatened", "Proposed Endangered") ~ "Species of Concern")) %>% 
  mutate(`Conservation Status` = replace_na(`Conservation Status`, "Not of Concern")) 

concernpercent_perstate <- speciespark2 %>% 
  separate(State, c("State1", "State2", "State3"), sep = ", ") %>% 
  pivot_longer(cols = c(State1, State2, State3), 
               names_to = "State Type", 
               values_to = "State") %>% 
  filter(!is.na(State)) %>% 
  group_by(State, `Conservation Status`) %>% 
  summarize(total_ofconcern = n()) %>% 
  mutate(total_species_perstate = sum(total_ofconcern)) %>% 
  ungroup() %>% 
  mutate(percent = (total_ofconcern/total_species_perstate)*100) %>% 
  filter(`Conservation Status` != "Not of Concern")

statevaluesmap_perc <- concernpercent_perstate %>% 
  full_join(states) %>% 
   mutate(state_name = str_to_lower(abbr2state(State)))

# GRAPHS START

statevaluesmap_perc %>%
  ggplot() +
  geom_map(
    map = fifty_states,
    aes(
      map_id = state_name,
      fill = percent
    )
  ) +
  expand_limits(x = map_data("state")$long, y = map_data("state")$lat) + 
  labs(fill = "Percent\nSpecies of\nConcern", title = "Percent Species of Concern per State") +
  theme_void()
```  

### California Heat Map
```
californiaconclusion <- read_csv("Biodiversity/californiaconclusion.csv")

caliconc <- californiaconclusion %>% 
  select(c('Park Code', 'Park', '# Endangered Species', 'Latitude', 'Longitude'))

# Obtaining the map tile

US_map2 <- get_stamenmap(
  bbox = c(left = -125, bottom = 33, right = -115, top = 45),
  maptype = "terrain",
  zoom = 7
)

# Putting the heat map on the tile

ggmap(US_map2) +
  geom_density_2d(data = caliconc, aes(x = Longitude, y = Latitude), size = 0.3) +
  stat_density_2d(data = caliconc, aes(x = Longitude, y = Latitude, fill = stat(level)), size = 0.05, alpha = .1, bins = 10, geom = "polygon", color = 'darkblue') +
  scale_alpha(guide = 'none') +
  scale_fill_gradient(low = "darkblue", high = "red", guide = 'none')
```  